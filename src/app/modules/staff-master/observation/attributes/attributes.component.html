<div class="col-lg-12">
  <div class="card-header">
    <h6>
      Student Observation Attribute
    </h6>
  </div>
  <!-- end card header -->
  <div class="card">
  <div class="card-body">
    <div class="row">
      <div class="col-xxl-5 col-md-6">
          <label for="categoryInput" class="form-label"
            >Category<span class="reqcss">*</span></label
          >
                    <select
            class="form-select mb-3"
            [(ngModel)]="newAttribute.studentObservationCategoryID"
            aria-label="Default select example"
            (change)="onCategoryChange(newAttribute.studentObservationCategoryID)"
            >
            <option selected>Select your Status</option>
            <option
                *ngFor="let item of studentObservationCategory"
                [value]="item.studentObservationCategoryID"
            >
                {{ item.categoryText }}
            </option>
            </select>
      </div>
      <div class="col-xxl-5 col-md-6">
          <label for="categoryInput" class="form-label"
            >Sub Category<span class="reqcss">*</span></label
          >
          <select
            class="form-select mb-3"
            [(ngModel)]="newAttribute.studentObservationSubCategoryID"
            aria-label="Default select example"
          >
            <option selected>Select your Status</option>
            <option
              *ngFor="let item of studentObservationSubCategoryRealData"
              [value]="item.studentObservationSubCategoryID"
            >
              {{ item.subCategory }}
            </option>
          </select>
        </div>
    </div>
    <div class="row">
        <div class="col-xxl-5 col-md-6">
          <label for="categoryInput" class="form-label">
            Attribute<span class="reqcss">*</span>
          </label>
          <input
            type="text"
            class="form-control"
            id="categoryInput"
            [(ngModel)]="newAttribute.attribute"
          />
        </div>
        <div class="col-xxl-5 col-md-6">
          <label for="categoryInput" class="form-label">
            Attribute Value<span class="reqcss">*</span>
          </label>
          <input
            type="number"
            class="form-control"
            id="categoryInput"
            [(ngModel)]="newAttribute.attributeValue"
          />
        </div>
        <div class="col-lg-2" *ngIf="!disable_data">
          <label for="categoryInput" class="form-label">&nbsp;<span class="reqcss"></span></label>
          <div class="hstack gap-2">
            <button type="button" class="btn btn-success" (click)="addAttribute()">
              <i class="fa fa-plus" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
      <br>
      <div class="row" *ngIf="!disable_data">
        <div class="col-lg-10">
          <div
            class="form-control"
            style="
              height: auto;
              max-height: 200px;
              overflow-y: auto;
              min-height: 100px !important;
            "
          >
            <ul class="list-group list-group-flush">
              <li *ngFor="let subCategory of updatedSubCategories; let i = index" >
                {{ subCategory.attribute }} < {{ subCategory.attributeValue }} >
                <i
                  class="fa fa-times danger"
                  style="color: red; cursor: pointer;"
                  aria-hidden="true"
                  (click)="removeSubCategory(i)"
                ></i>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-lg-2">
          <button type="button" class="btn btn-danger" (click)="resetForm()">
            <i class="fa fa-refresh" aria-hidden="true"></i>
          </button>
        </div>
      </div>
      

    <div class="row" >
      <label for="categoryInput" class="form-label"
        >&nbsp;<span class="reqcss"></span
      ></label>
      <div class="hstack gap-2">
        <button
          type="button"
          *ngIf="!disable_data"
          class="btn btn-success"
          (click)="addOrUpdateSubCategory()"
        >
          Submit
        </button>
        <button
          type="button"
          *ngIf="disable_data"
          class="btn btn-success"
          (click)="UpdateSubCategory()"
        >
          Update
        </button>
        <button type="button" class="btn btn-danger" (click)="resetForm()">
          Reset
        </button>
      </div>
    </div>
    <br />
    <div class="col-xl-12">
      <div class="card">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table align-middle table-nowrap mb-0">
              <thead class="table-light">
                <tr>
                  <th scope="col">Attribute</th>
                  <th scope="col">Attribute Value</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let category of transformedData">
                  <tr class="category-row">
                    <td colspan="3" class="bg-light font-weight-bold">
                      <button
                        type="button"
                        class="btn btn-link"
                        (click)="category.isExpanded = !category.isExpanded"
                      >
                        <i
                          [ngClass]="{
                            'ri-arrow-down-s-line': category.isExpanded,
                            'ri-arrow-right-s-line': !category.isExpanded
                          }"
                        ></i>
                      </button>
                      Category: {{ category.categoryName }}
                    </td>
                  </tr>
                  <ng-container *ngIf="category.isExpanded">
                    <ng-container *ngFor="let subCategory of category.subCategories">
                      <tr class="subcategory-row">
                        <td colspan="3" class="font-weight-bold" style="
                        padding-left: 26px !important;
                    ">
                          <button
                            type="button"
                            class="btn btn-link"
                            (click)="subCategory.isExpanded = !subCategory.isExpanded"
                          >
                            <i
                              [ngClass]="{
                                'ri-arrow-down-s-line': subCategory.isExpanded,
                                'ri-arrow-right-s-line': !subCategory.isExpanded
                              }"
                            ></i>
                          </button>
                          Sub Category: {{ subCategory.subCategoryName }}
                        </td>
                      </tr>
                      <ng-container *ngIf="subCategory.isExpanded">
                        <ng-container *ngFor="let attribute of subCategory.attributes">
                          <tr class="attribute-row">
                            <td class="fw-medium hstack gap-2">
                              <button
                                type="button"
                                class="btn btn-warning btn-icon"
                                (click)="editAttribute(attribute)"
                              >
                                <i class="ri-pencil-line"></i>
                              </button>
                              <button
                                type="button"
                                class="btn btn-danger btn-icon"
                                (click)="deleteAttribute(attribute)"
                              >
                                <i class="ri-delete-bin-5-line"></i>
                              </button>
                            </td>
                            <td >{{ attribute.attribute }}</td>
                            <td>{{ attribute.attributeValue }}</td>
                       
                          </tr>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
</div>
